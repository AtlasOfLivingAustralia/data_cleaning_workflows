---
title: "Metadata for Curated Plant and Invertebrate Data for Bushfire Modelling"
author: "Margot Schneider & Martin Westgate"
output: html_document
date: "2022-12-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(skimr)
library(janitor)
library(tidyverse)
library(galah) # remotes::install_github("AtlasOfLivingAustralia/galah")
library(showtext) # install.packages("showtext")
library(ozmaps)
library(sf)
library(ggpointdensity)
library(here)
library(tibble)
library(gt)

remotes::install_github("olihawkins/pilot")

```


```{r pressure, echo=FALSE, message=FALSE, warning=FALSE}
inverts <- read_csv(here("data", "invertebrate.data.fixed.csv"))
plants <- read_csv(here("data", "vascularplant.data.fixed.csv"))


inverts <- inverts |>
  drop_na() |>                      # drop NAs
  filter(longitude < 155,    # filter records to only mainland/tasmania
         longitude > 110,
         latitude > -45,
         latitude < -10)

# Add font
font_add_google("Roboto", "roboto")
showtext_auto(enable = TRUE)

#inverts
inverts_points_map <- ggplot() +
  geom_sf(data = ozmap_states,
          fill = "white") +
  coord_sf(xlim = c(110, 160), ylim = c(-10, -44)) +
  geom_pointdensity(data = inverts,
                    mapping = aes(x = longitude,
                                  y = latitude)) +
  viridis::scale_color_viridis(option = "F",
                               begin = 0.1) +
  labs(title = NULL,
       x = NULL,
       y = NULL) +
  theme_bw() +
  guides(colour = guide_colourbar(
    title = "Number of \nOverlapping points"),
    alpha = "none") +
  theme(legend.position = "left",
        legend.margin = margin(0, 0, 0, 0),
        legend.box.margin = margin(0, 0, 0, 0),
        legend.direction = "vertical",
        legend.title.align = 0.5,
        text = element_text(family = "roboto"),
        #axis.text.x = element_blank(),
        #axis.text.y = element_blank(),
        plot.title = element_text(size = 27,
                                  face = "bold",
                                  color = "#404040",
                                  hjust = 0.5,
                                  margin = margin(0, 0, 20, 0)))


#plants
plants_points_map <- ggplot() +
  geom_sf(data = ozmap_states,
          fill = "white") +
  coord_sf(xlim = c(142, 155), ylim = c(-22, -40)) +
  geom_pointdensity(data = plants,
                    mapping = aes(x = longitude_used,
                                  y = latitude_used)) +
  viridis::scale_color_viridis(option = "F",
                               begin = 0.1) +
  labs(title = NULL,
       x = NULL, 
       y = NULL) +
theme_bw() +
  guides(colour = guide_colourbar(
    title = "Number of \nOverlapping points"),
    alpha = "none") +
  theme(legend.position = "left",
        legend.margin = margin(0, 0, 0, 0),
        legend.box.margin = margin(0, 0, 0, 0),
        legend.direction = "vertical",
        legend.title.align = 0.5,
        text = element_text(family = "roboto"),
        #axis.text.x = element_blank(),
        #axis.text.y = element_blank(),
        plot.title = element_text(size = 27,
                                  face = "bold",
                                  color = "#404040",
                                  hjust = 0.5,
                                  margin = margin(0, 0, 20, 0)))

```


## Collection Description 

This data asset contains observations of individual plants and animals ("occurrences") sourced from the Atlas of Living Australia. Data on vascular plants are based on the following paper:

> Godfree et al. (2021) Implications of the 2019-2020 Megafires for the Biogeography and Conservation of Australian Vegetation. _Nature Communications_ **12**: 1023 [https://doi.org/10.1038/s41467-021-21266-5](https://doi.org/10.1038/s41467-021-21266-5)

Data on invertebrates are from the following report: 

> Marsh et al. (2021) Threatened species hub report: Assessment of the impacts of the 2019-20 wildfires on southern and eastern Australia on invertebrate species. [NESP Threatened Species Recovery Hub Project 8.3.1 Final report](https://www.nespthreatenedspecies.edu.au/media/b2oi2hyc/8-3-1-assessment-of-the-impacts-of-the-2019-20-wildfires-of-southern-and-eastern-australia-on-invertebrate-species-final-report_v3.pdf), Brisbane.

Both studies were performed to understand the impacts of the Australian "Black Summer" (2019-20) fires on the taxonomic group in question. Consequently, this aggregated dataset is designed to support off-the-shelf bushfire impact modelling, and to provide useful context for associated biodiversity conservation work. A total of 896 species of vascular plants and 44,146 invertebrate species are represented in these data sets (Table 1).

The combined data asset was produced by the Science & Decision Support Team at the [Atlas of living Australia](https://www.ala.org.au) (ALA) in collaboration with the authors of the original data sets. This was done as part of an [Australian Research Data Commons](https://www.ardc.edu.au) (ARDC) bushfire data challenges project. The data contained in this deposition has been cleaned by researchers and taxonomists to ensure it is of high quality. Therefore, compared to data returned by the ALA, the unique record ID's may return a different species or location than is denoted in this data set: these records have potentially been changed by the authors of the data to reflect what they believe is correct. 

<br>
**Table 1:** Summary of Invertebrate and Vascular Plant Data
```{r echo=FALSE}

table_df <- tibble(
  taxon = c("Invertebrates", "Vascular Plants"),
  class = c(46, 7),
  family = c(2044, 76),
  species = c(44146, 896),
  records = c(300987, 41572)
)

table_df |>
  gt() |>
  cols_align(align = c("left"), columns = 1) |>
  fmt_number(columns = 2:5,
             sep_mark = ",",
             decimals = 0) |>
  cols_label(
    taxon = md("**Taxonomic Group**"),
    class = md("**Classes**"),
    family = md("**Families**"),
    species = md("**Species**"),
    records = md("**Records**")) |>
  tab_options(table.width = pct(90))
```
<br>

## Invertebrate Data
The invertebrate data consists of records sourced from the Atlas of Living Australia (Figure 1). Data from citizen science organisations was removed to reduce data quality issues. The spatial scope of the study was set at the whole of mainland Australia, so as to support calculation of bushfire impact metrics against a baseline of all known invertebrate populations nationwide (i.e. not solely within south-eastern Australia). All data was cleaned in R to remove and correct as many taxonomic, temporal, and geospatial issues as possible, and to ensure accurate modelling. All records prior to 1990 were removed unless less than 3 records per species would be left after this filter was applied. The original published dataset can be found on Zenodo at [https://doi.org/10.5281/zenodo.6395707](https://doi.org/10.5281/zenodo.6395707). 

The data found on the Zenodo repository is missing all records which were present in both the ALA database that were also provided by external data providers. Marsh et al. (2021) prioritized keeping non-ALA data which was present in both databases. In contrast, the current dataset prioritizes retention of ALA data over that from other sources. It therefore contains an additional 67,033 records which were previously removed due to cross institutional duplication. **There are 71 rows where the scientific name is `Incertae sedis` meaning species needing investigation. The higher taxonomy of this `Incertae sedis` is variable and if you are plotting at the species level with `scientific_name` we recommend you remove these records.**

```{r echo=FALSE, fig.height=11, fig.width=13, message=FALSE, warning=FALSE, fig.cap = "**Figure 1:** Visual representation of Invertebrate Data by Marsh and colleagues (2021). Missing values have been removed, while records outside of longitude < 155, longitude > 110, latitude > -45, latitude < -10 have been removed for visualisation purposes. Points represent individual records, colour gradient shows density of overlapping points, dark purple = < 5000 records , light orange > 20000 records."}

inverts_points_map
```

## Vascular Plant Data
The Vascular Plant data was restricted to records downloaded from the Australian Virtual Herbarium (a subset of the ALA database) to reduce issues with data quality. Records were restricted to South Eastern Australia: 144.01, −39.17 (bottom left) to 154.0, −25.34077 (top right) (Figure 2). Data were cleaned using a combination of R and OpenRefine to remove and correct as many taxonomic, temporal, and geospatial issues as possible to ensure accurate modelling. This combination of automated and manual processes allowed for finer scale data quality issues to be detected than by automated methods alone. All records prior to 1950 were removed. The original published dataset can be found on the CSIRO Data Access Portal at [https://doi.org/10.25919/sd7h-ff33](https://doi.org/10.25919/sd7h-ff33). 

**The authors recommend using `species` as the lowest level taxonomic classification for analysis as this is the most consistent. `scientific_name` contains some naming authorities and sub-species information which have not been validated by the authors making it lack consistency.** 

Since publication of the original dataset, it has been further investigated by the source team to improve its' quality. Also, and in contrast to the invertebrate dataset, the vascular plant dataset includes additional information to give the user a better understanding of how the data has changed through the data cleaning process. Specifically, the columns `latitude_original` and `longitude_original` refer to the downloaded coordinates, while `latitude_used` and `longitude_used` show processed coordinates. Similarly `scientific_name_original` and `scientific_name` provide the same information for taxonomic corrections. Only plants found to have a range that was more than 50% impacted by the 2019/2020 fires in the analysis by Godfree et al., (2021) are included in this data deposition, equating to 896 species of plants.

Exact duplicates have been removed from this data set; that is, where there are >1 records with identical `record_id` values, and which display the same coordinates. A related but different issue exists with herbarium records, whereby the same specimen can be sent to multiple herbaria, creating two records with different `record_id`'s that describe the same individual. Because duplicates of this kind can be given slightly different labels, they are harder to detect than duplicates that emerge within a database. Where duplicates of this kind were suspected by the research team, they were marked as `TRUE` in the `duplicate_specimen_flag` column. All associated duplicates are flagged, meaning that if you did want to remove them, you will need to keep one of each duplicate.  

```{r echo=FALSE, fig.height=7, fig.width=8, message=FALSE, warning=FALSE, fig.cap = "**Figure 2:** Visual representation of Vascular Plant Data by Godfree and colleagues (2021). Points represent indivual records, colour gradient shows density of overlapping points, dark purple = < 2000 records , light orange > 6000 records."}

plants_points_map
```

---
title: "Investigating WORMS"
author: "Fonti Kar"
date: "2022-08-30"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# install.packages("worrms") https://docs.ropensci.org/worrms/index.html

pacman::p_load(tidyverse, worrms)
```

Read in AFD list

```{r}
afd_taxonomy <- read.csv("output/afd_species_clean.csv")
afd_species <- unique(afd_taxonomy$VALID_NAME) 
```

## A small test

```{r}
set.seed(8)

x <- sample(afd_species, 50) 

test_alltypes_ls <- wm_records_names(x)
test_alltypes_df <- bind_rows(test_alltypes_ls)

test_df |> select(scientificname, starts_with("is")) 

x[which(x %in% marine_sp)] # Seems to work well! 

```

## Lets expand it

```{r}
# If I do full list, it runs out of memory, reducing list to 500, 200, 100 seems to work
# afd_species_ls <- wm_records_names(afd_species) |> bind_rows() 

afd_species_ls <- wm_records_names(afd_species[1:100]) |> bind_rows()
```

## Workflow to exclude marine species from AFD checklist

```{r}
afd_species_ls |> pull(scientificname) -> marine_afd

## Excluding the marine species in VALID_NAME
afd_taxonomy |> filter(! VALID_NAME %in% marine_afd) -> afd_taxonomy_nomarine
```


